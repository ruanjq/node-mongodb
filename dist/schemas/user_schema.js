"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var mongoose=require("mongoose"),bcrypt=require("bcrypt"),saltRounds=10,Schema=mongoose.Schema,UserSchema=new Schema({username:String,sex:{type:Number,enum:[1,0],default:1},pwd:String,birthday:{type:Date,default:Date.now()},email:{type:String,default:""},avatar:{type:String,default:"/images/default.png"},meta:{createAt:{type:Date,default:Date.now()},updateAt:{type:Date,default:Date.now()}}});UserSchema.pre("save",function(e){var t=this;this.isNew||(this.meta.updateAt=Date.now()),bcrypt.genSalt(saltRounds,function(a,r){if(a)return e(a);bcrypt.hash(t.pwd,r,function(a,r){if(a)return e(a);t.pwd=r,e()})})}),UserSchema.methods={validPassword:function(e,t){bcrypt.compare(e,this.pwd,function(e,a){if(e)return next(e);t(a)})}},exports.default=UserSchema;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjaGVtYXMvdXNlcl9zY2hlbWEuanMiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJyZXF1aXJlIiwiYmNyeXB0Iiwic2FsdFJvdW5kcyIsIlNjaGVtYSIsInR5cGUiLCJOdW1iZXIiLCJVc2VyU2NoZW1hIiwidXNlcm5hbWUiLCJTdHJpbmciLCJlbnVtIiwiZGVmYXVsdCIsIkRhdGUiLCJub3ciLCJiaXJ0aGRheSIsImVtYWlsIiwiYXZhdGFyIiwiY3JlYXRlQXQiLCJwcmUiLCJuZXh0IiwiX3RoaXMiLCJ0aGlzIiwiaXNOZXciLCJnZW5TYWx0IiwiZXJyIiwic2FsdCIsIm1ldGEiLCJ1cGRhdGVBdCIsImhhc2giLCJ2YWxpZFBhc3N3b3JkIiwiX3B3ZCIsImNiIiwiY29tcGFyZSIsInB3ZCIsImlzTWF0aGNoIl0sIm1hcHBpbmdzIjoib0VBQUEsSUFBTUEsU0FBV0MsUUFBUSxZQUNuQkMsT0FBU0QsUUFBUSxVQUNqQkUsV0FBYSxHQUNmQyxPQUFTSixTQUFTSSxPQUZoQkYsV0FBU0QsSUFBUUcsUUFDakJELFNBQUFBLE9BQ0ZDLEtBTUlDLEtBQU1DLE9BSFZDLE1BQUFBLEVBQUFBLEdBQ0FDLFFBQVVDLEdBRU5KLElBQUFBLE9BQ0FLLFVBQ0FDLEtBQUFBLEtBTG9CQSxRQUFBQyxLQUFBQyxPQVF4QkMsT0FDSVQsS0FBQUEsT0FDQU0sUUFBQUEsSUFFSkksUUFDSVYsS0FBQUEsT0FDQU0sUUFBQUEsdUJBRUpLLE1BQ0lYLFVBQ0FNLEtBQVFDLEtBbEJZRCxRQUFBQyxLQUFBQyxPQXFCcEJJLFVBQ0laLEtBQU1PLEtBQ05ELFFBQVNDLEtBQUtDLFVBRVJOLFdBQUFXLElBQUEsT0FBQSxTQUFBQyxHQUFBLElBQUFDLEVBQUFDLEtBVWJBLEtBQUtDLFFBSFZmLEtBQUFBLEtBQVdXLFNBQVlOLEtBQUFDLE9BRXRCWCxPQUFBcUIsUUFBQXBCLFdBQUEsU0FBQXFCLEVBQUFDLEdBQ0csR0FBQ0QsRUFBS0YsT0FBTUgsRUFBQUssR0FDZHRCLE9BQUt3QixLQUFLQyxFQUFBQSxJQUFXZixFQUFLQyxTQUFMVyxFQUFyQkksR0FPVSxHQUFJSixFQUFLLE9BQU9MLEVBQUtLLEdBSnRCRCxFQUFBQSxJQUFRcEIsRUFDUHFCLFVBS0FMLFdBQUFBLFNBQ0hVLGNBREdWLFNBSkpXLEVBQUFDLEdBRko3QixPQUFBOEIsUUFBQUYsRUFBQVQsS0FBQVksSUFBQSxTQUFBVCxFQUFBVSxHQVBKLEdBQUFWLEVBQUEsT0FBQUwsS0FBQUssR0FzQllPLEVBQUdHLHVCQUZQM0IiLCJmaWxlIjoic2NoZW1hcy91c2VyX3NjaGVtYS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0Jyk7XHJcbmNvbnN0IHNhbHRSb3VuZHMgPSAxMDtcclxubGV0IFNjaGVtYSA9IG1vbmdvb3NlLlNjaGVtYTtcclxuXHJcblxyXG5sZXQgVXNlclNjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdXNlcm5hbWU6IFN0cmluZyxcclxuICAgIHNleDp7XHJcbiAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgIGVudW06WzEsMF0sXHJcbiAgICAgICAgZGVmYXVsdDogMSAgLy8gMTog55S3ICAwOuWls1xyXG4gICAgfSxcclxuICAgIHB3ZDogU3RyaW5nLFxyXG4gICAgYmlydGhkYXk6IHtcclxuICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgIGRlZmF1bHQ6IERhdGUubm93KCksXHJcbiAgICB9LFxyXG4gICAgZW1haWw6e1xyXG4gICAgICAgIHR5cGU6U3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6JydcclxuICAgIH0sXHJcbiAgICBhdmF0YXI6e1xyXG4gICAgICAgIHR5cGU6U3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6XCIvaW1hZ2VzL2RlZmF1bHQucG5nXCJcclxuICAgIH0sXHJcbiAgICBtZXRhOiB7XHJcbiAgICAgICAgY3JlYXRlQXQ6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3coKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXBkYXRlQXQ6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3coKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcblxyXG5Vc2VyU2NoZW1hLnByZShcInNhdmVcIiwgZnVuY3Rpb24obmV4dCl7XHJcblxyXG5cdC8vIOWIpOaWreaWh+aho+aYr+WQpuS4uuaWsFxyXG5cdGlmKCF0aGlzLmlzTmV3KXtcclxuXHRcdHRoaXMubWV0YS51cGRhdGVBdCA9IERhdGUubm93KCk7XHJcblx0fVxyXG5cclxuICAgIGJjcnlwdC5nZW5TYWx0KHNhbHRSb3VuZHMsIChlcnIsIHNhbHQpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpXHJcbiAgICAgICAgYmNyeXB0Lmhhc2godGhpcy5wd2QsIHNhbHQsIChlcnIsIGhhc2gpID0+IHtcclxuICAgICAgICAgICAgLy8gU3RvcmUgaGFzaCBpbiB5b3VyIHBhc3N3b3JkIERCLlxyXG4gICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gbmV4dChlcnIpO1xyXG4gICAgICAgICAgICB0aGlzLnB3ZCA9IGhhc2g7XHJcbiAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcblVzZXJTY2hlbWEubWV0aG9kcyA9IHtcclxuICAgIHZhbGlkUGFzc3dvcmQoX3B3ZCxjYil7XHJcbiAgICAgICAgYmNyeXB0LmNvbXBhcmUoX3B3ZCx0aGlzLnB3ZCwoZXJyLGlzTWF0aGNoKSA9PntcclxuICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIG5leHQoZXJyKTtcclxuICAgICAgICAgICAgY2IoaXNNYXRoY2gpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBVc2VyU2NoZW1hO1xyXG4iXX0=
